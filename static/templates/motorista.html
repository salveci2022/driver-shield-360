<!doctype html><html lang="pt-BR"><head><meta charset="utf-8"><title>Motorista - Driver Shield 360</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"></head><body><div class="container"><div class="card"><div class="header"><div class="title">ğŸš• Painel do Motorista</div><div class="row"><button class="btn small" onclick="goFull()">â›¶ Tela cheia</button><button class="btn small" onclick="location.reload()">Reiniciar</button><button class="btn small danger" onclick="limpar()">Limpar alertas</button><a class="btn small" href="/">Sair</a></div></div><div class="grid"><div class="card"><div class="title" style="font-size:18px">Tipo de ocorrÃªncia</div><label>Selecione</label><select id="ocorrencia" class="input"><option value="Abordagem suspeita">Abordagem suspeita</option><option value="Tentativa de assalto">Tentativa de assalto</option><option value="AmeaÃ§a / intimidaÃ§Ã£o">AmeaÃ§a / intimidaÃ§Ã£o</option><option value="Passageiro agressivo">Passageiro agressivo</option><option value="Seguimento / perseguiÃ§Ã£o">Seguimento / perseguiÃ§Ã£o</option><option value="EmergÃªncia mÃ©dica">EmergÃªncia mÃ©dica</option><option value="Outro">Outro</option></select><label>Seu nome (opcional)</label><input id="motoristaNome" class="input" placeholder="Ex: JoÃ£o (Uber)"><hr><div class="title" style="font-size:18px">Pessoas de confianÃ§a cadastradas</div>{% if contacts and contacts|length > 0 %}<ul>{% for c in contacts %}<li><b>{{ c.nome }}</b> â€” {{ c.telefone }}</li>{% endfor %}</ul>{% else %}<div class="notice">Nenhuma pessoa cadastrada ainda. VÃ¡ em â€œCadastroâ€.</div>{% endif %}</div><div class="card"><div class="title" style="font-size:18px">BotÃ£o de PÃ¢nico</div><div class="sos-wrap"><button id="sosBtn" class="sos-btn" onclick="enviar()">SOS</button></div><div id="status" class="notice">Clique em SOS para enviar alerta com localizaÃ§Ã£o e ocorrÃªncia.</div><hr><div class="title" style="font-size:18px">LocalizaÃ§Ã£o</div><div class="notice" id="locTxt">Aguardando localizaÃ§Ã£oâ€¦</div></div></div></div></div><script>
function goFull(){const el=document.documentElement;if(el.requestFullscreen)el.requestFullscreen();}
let lastPos=null;
function getLocation(){if(!navigator.geolocation){document.getElementById('locTxt').textContent='GeolocalizaÃ§Ã£o nÃ£o disponÃ­vel neste dispositivo.';return;}
navigator.geolocation.getCurrentPosition((pos)=>{lastPos={lat:pos.coords.latitude,lng:pos.coords.longitude};document.getElementById('locTxt').textContent=`Lat: ${lastPos.lat.toFixed(6)} | Lng: ${lastPos.lng.toFixed(6)} (precisÃ£o: ~${Math.round(pos.coords.accuracy)}m)`;},()=>{document.getElementById('locTxt').textContent='Permita o acesso Ã  localizaÃ§Ã£o no navegador/celular.';},{enableHighAccuracy:true,timeout:8000,maximumAge:5000});}
getLocation();setInterval(getLocation,15000);
async function enviar(){const btn=document.getElementById('sosBtn');btn.disabled=true;const ocorrencia=document.getElementById('ocorrencia').value;const motorista=document.getElementById('motoristaNome').value||'Motorista';await new Promise((resolve)=>{if(!navigator.geolocation){resolve();return;}navigator.geolocation.getCurrentPosition((pos)=>{lastPos={lat:pos.coords.latitude,lng:pos.coords.longitude};resolve();},()=>resolve(),{enableHighAccuracy:true,timeout:8000,maximumAge:0});});
const payload={motorista,ocorrencia,lat:lastPos?lastPos.lat:null,lng:lastPos?lastPos.lng:null};
const res=await fetch('/api/panic',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});const j=await res.json();
if(j.ok){btn.classList.add('sent');btn.textContent='ENVIADO';document.getElementById('status').textContent='âœ… Alerta enviado com sucesso.';}else{document.getElementById('status').textContent='âŒ Falha ao enviar alerta.';}
setTimeout(()=>{btn.disabled=false;btn.classList.remove('sent');btn.textContent='SOS';},6000);
}
async function limpar(){if(!confirm('Limpar todos os alertas do sistema?'))return;const res=await fetch('/api/clear_alerts',{method:'POST'});const j=await res.json();alert(j.ok?'Alertas limpos!':'Falha ao limpar.');}
</script></body></html>
