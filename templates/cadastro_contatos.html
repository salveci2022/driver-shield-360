<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Cadastro – Pessoas de confiança | {{ app_name }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="wrap">
    <header class="top">
      <h1>Cadastro de Pessoas de Confiança</h1>
      <p class="sub">Cadastre até <strong>3 pessoas</strong> para receberem os alertas de emergência do motorista.</p>
    </header>

    {% if msg %}
      <div class="alert">{{ msg }}</div>
    {% endif %}

    <section class="card">
      <h2>Novo cadastro</h2>
      <form method="post" class="grid">
        <label>
          <span>Nome do contato</span>
          <input name="name" required placeholder="Ex.: Maria">
        </label>

        <label>
          <span>Login (e-mail ou usuário)</span>
          <input name="login" required placeholder="Ex.: maria@gmail.com">
        </label>

        <label>
          <span>Senha</span>
          <input name="senha" type="password" required placeholder="Crie uma senha">
        </label>

        <button class="btn primary" type="submit">Salvar contato</button>
      </form>
      <div class="muted small">Obs.: Guarde o login e a senha — eles serão usados para entrar no painel.</div>
    </section>

    <section class="card">
      <h2>Contatos cadastrados</h2>

      {% if contacts and contacts|length > 0 %}
        <ul class="list">
          {% for c in contacts %}
            <li>
              <strong>{{ c.name }}</strong>
              <span class="pill">{{ c.login }}</span>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="muted">Nenhum contato cadastrado ainda.</div>
      {% endif %}

      <div class="actions">
        <button class="btn" id="btnClear" type="button">Apagar todos</button>
        <a class="btn" href="{{ url_for('login') }}">Ir para Login</a>
        <a class="btn ghost" href="{{ url_for('motorista') }}">Voltar</a>
      </div>
    </section>

    <footer class="foot">
      <a href="{{ url_for('termos') }}">Termos / Aviso Legal</a>
    </footer>
  </div>

<script>
document.getElementById("btnClear")?.addEventListener("click", async () => {
  if (!confirm("Apagar TODOS os contatos cadastrados?")) return;
  const res = await fetch("/api/clear_contacts", { method: "POST" });
  if (res.ok) location.reload();
  else alert("Não foi possível apagar agora.");
});
</script>
</body>
</html>
