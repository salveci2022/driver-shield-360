<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Cadastro — Driver Shield 360</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="icon" href="/static/driver_shield_360.png">
</head>
<body>
<div class="container">
  <div class="header">
    <div class="brand">
      <div class="logo"><img src="/static/driver_shield_360.png" alt="Logo"></div>
      <div>
        <h1 class="h1">Cadastro de Pessoas de Confiança</h1>
        <div class="subtitle">Esses contatos recebem o alerta que você acionar.</div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="row">
      <div style="flex:1; min-width:260px">
        <div class="field">
          <label for="name">Nome</label>
          <input id="name" placeholder="Ex.: Maria (esposa)" autocomplete="name">
        </div>
      </div>
      <div style="flex:1; min-width:260px">
        <div class="field">
          <label for="phone">Telefone (WhatsApp)</label>
          <input id="phone" placeholder="Ex.: +55 61 99999-9999" inputmode="tel" autocomplete="tel">
        </div>
      </div>
    </div>

    <div class="btnbar">
      <button class="btn btn-primary" id="addBtn">Adicionar contato</button>
      <a class="btn btn-secondary" href="/motorista">Voltar ao painel</a>
      <a class="btn btn-secondary" href="/termos" target="_blank" rel="noopener">Termos (LGPD)</a>
    </div>

    <div class="hr"></div>

    <div class="field">
      <label>Contatos cadastrados</label>
      <div class="notice">Dica: mantenha pelo menos 2 contatos (família e amigo).</div>
      <ul class="list" id="list"><li>Carregando…</li></ul>
    </div>
  </div>
</div>

<script>
function $(id){ return document.getElementById(id); }

async function load(){
  const ul = $("list");
  ul.innerHTML = "<li>Carregando…</li>";
  try{
    const r = await fetch("/api/contacts");
    const data = await r.json();
    if(!data.ok) throw new Error();
    ul.innerHTML = "";
    if(!data.contacts.length){
      ul.innerHTML = "<li>Nenhum contato cadastrado.</li>";
      return;
    }
    data.contacts.forEach(c=>{
      const li = document.createElement("li");
      li.innerHTML = `<b>${c.name}</b> — ${c.phone} &nbsp; <a href="#" data-id="${c.id}">remover</a>`;
      li.querySelector("a").onclick = async (e)=>{
        e.preventDefault();
        if(!confirm("Remover este contato?")) return;
        await fetch("/api/contacts/"+c.id, {method:"DELETE"});
        load();
      };
      ul.appendChild(li);
    });
  }catch(e){
    ul.innerHTML = "<li>Erro ao carregar contatos.</li>";
  }
}

async function add(){
  const name = $("name").value.trim();
  const phone = $("phone").value.trim();
  if(name.length < 2 || phone.length < 8){
    alert("Preencha nome e telefone corretamente.");
    return;
  }
  const r = await fetch("/api/contacts", {method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({name, phone})});
  const data = await r.json();
  if(!data.ok){ alert(data.error || "Erro"); return; }
  $("name").value=""; $("phone").value="";
  load();
}

$("addBtn").onclick = add;
load();
</script>
</body>
</html>
