<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>RelatÃ³rio | {{ app_name }}</title>
  <link rel="icon" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand">
        <span style="font-size:20px">ğŸ“„</span>
        <div>
          <div style="font-size:20px">RelatÃ³rio de Alertas</div>
          <div class="small">HistÃ³rico de SOS registrados no sistema.</div>
        </div>
      </div>
      <div class="actions">
        <button class="btn danger" onclick="clearAlerts()">ğŸ§¹ Limpar</button>
        <a class="btn ghost" href="/painel">ğŸ‘¥ Painel</a>
        <a class="btn ghost" href="/motorista">ğŸš— Motorista</a>
        <a class="btn" href="/">âŸµ Sair</a>
      </div>
    </div>

    <div class="card">
      <h2>Registros</h2>
      <div id="rows" class="small">Carregando...</div>
    </div>
  </div>

  <div id="toast" class="toast"></div>
  <script src="{{ url_for('static', filename='main.js') }}"></script>
  <script>
    function row(a){
      return `
        <div class="card" style="margin:10px 0">
          <div class="kv">
            <span class="pill">ğŸš¨ ${a.occurrence||"SOS"}</span>
            ${a.driver_name?`<span class="pill">ğŸ‘¤ ${a.driver_name}</span>`:""}
            ${(a.lat && a.lng)?`<span class="pill">ğŸ“ ${Number(a.lat).toFixed(6)}, ${Number(a.lng).toFixed(6)}</span>`:""}
            ${a.accuracy?`<span class="pill">Â±${Math.round(a.accuracy)}m</span>`:""}
          </div>
          <div class="small" style="margin-top:10px">â± ${a.created_at}</div>
        </div>
      `;
    }

    async function load(){
      const j = await jget("/api/alerts");
      const arr = j.alerts||[];
      const box = document.getElementById("rows");
      if(arr.length===0){ box.textContent = "Nenhum alerta registrado."; return; }
      box.innerHTML = arr.map(row).join("");
    }

    async function clearAlerts(){
      try{
        await jpost("/api/alerts/clear",{});
        toast("Limpo");
        load();
      }catch(e){ toast("Falha ao limpar"); }
    }

    load();
  </script>
</body>
</html>
